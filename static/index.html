<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
		<title>COVID-19 Time Series</title>
		<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" 
			integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs="
			crossorigin="anonymous"></script>
		<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
		<link href="https://unpkg.com/material-components-web@v4.0.0/dist/material-components-web.min.css" rel="stylesheet">
		<script src="https://unpkg.com/material-components-web@v4.0.0/dist/material-components-web.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

		<style type="text/css">
		body { margin: 0; padding: 0; background-color: #404040;}
		
		:root {
			--mdc-theme-primary: #048C93;
			--mdc-theme-secondary: #F37306;
			--mdc-theme-on-primary: #fff;
			--mdc-theme-on-secondary: #fff;
			--mdc-theme-background: #404040;
			--mdc-theme-surface: #404040;
			--mdc-theme-on-surface: #eee;
			--mdc-theme-error: #E20531;
		}

		.tabcontent {
			display: none;
		}

		.tabcontent--active {
			display: block;
		}

		.mdc-tab .mdc-tab__text-label {
			color: #4ABABF;
		}

		.mdc-tab--active .mdc-tab__text-label {
			color: #eee;
		}

		.mdc-tab--active {
			background-color: rgba(4, 140, 147, .2);
		}

		.appcontent {
			padding: 0em 1em 0 1em;
		}

		.appcontent .appcontent-inner {
			padding-top: 1em;
		}

		.tabpanel {
			background-color: rgba(4, 140, 147, .1);
			padding: 0 1em; 
		}
		div.unit {
			display: flex;
			height:82vh; width:100%;
		}
		@media screen and (orientation: portrait) { div.unit { height:82vh; width:100%;}  }


		</style>
	</head>
	<body>
		<!--header class="mdc-top-app-bar mdc-top-app-bar--fixed">
			<div class="mdc-top-app-bar__row">
				<section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start">
					<button class="material-icons mdc-top-app-bar__navigation-icon mdc-icon-button">menu</button>
					<span class="mdc-top-app-bar__title">COVID-19 Time Series</span>
				</section>
			</div>
		</header-->
		<section class="appcontent"><div class="appcontent-inner">
			<div class="mdc-tab-bar" role="tablist">
				<div class="mdc-tab-scroller">
					<div class="mdc-tab-scroller__scroll-area">
					<div class="mdc-tab-scroller__scroll-content">
						<button class="mdc-tab mdc-tab--active" role="tab" aria-selected="true" tabindex="0">
							<span class="mdc-tab__content">
								<span class="mdc-tab__text-label">Confirmed cases</span>
							</span>
							<span class="mdc-tab-indicator mdc-tab-indicator--active">
								<span class="mdc-tab-indicator__content mdc-tab-indicator__content--underline"></span>
							</span>
							<span class="mdc-tab__ripple"></span>
						</button>
						<button class="mdc-tab" role="tab" aria-selected="true" tabindex="0">
							<span class="mdc-tab__content">
								<span class="mdc-tab__text-label">7-day new cases</span>
							</span>
							<span class="mdc-tab-indicator">
								<span class="mdc-tab-indicator__content mdc-tab-indicator__content--underline"></span>
							</span>
							<span class="mdc-tab__ripple"></span>
						</button>
						<button class="mdc-tab" role="tab" aria-selected="true" tabindex="0">
							<span class="mdc-tab__content">
								<span class="mdc-tab__text-label">Death rates</span>
							</span>
							<span class="mdc-tab-indicator">
								<span class="mdc-tab-indicator__content mdc-tab-indicator__content--underline"></span>
							</span>
							<span class="mdc-tab__ripple"></span>
						</button>
					</div>
					</div>
				</div>
			</div>
		</div></section>
		<section class="appcontent tabcontent tabcontent--active">
			<div class="appcontent-inner tabpanel ">
				<div class="unit" id="chart"></div>
				<div class="unit" id="chartw"></div>
			</div>
		</section>
		<section class="appcontent tabcontent">
			<div class="appcontent-inner tabpanel ">
				<div class="unit" id="chartn"></div>
				<div class="unit" id="chartnw"></div>
			</div>
		</section>
		<section class="appcontent tabcontent">
			<div class="appcontent-inner tabpanel ">
				<div class="unit" id="chartd"></div>
				<div class="unit" id="chartdw"></div>
			</div>
		</section>
		
		
		<script>
			/*
			https://colorschemedesigner.com/csd-3.5/#2G422vfuuuDq3
			Primary Color:
			48D205	50A029	2E8C02	6CE433	85E457
			Secondary Color A:
			048C93	1D6C70	025D62	2BB8BF	4ABABF
			Secondary Color B:
			F37306	B96F30	A24C02	F89037	F8A55F
			Complementary Color:
			E20531	AC2C45	96021F	EE3559	EE5B78
			72	210	5
			80	160	41
			46	140	2
			108	228	51
			133	228	87

			4	140	147
			29	108	112
			2	93	98
			43	184	191
			74	186	191

			243	115	6
			185	111	48
			162	76	2
			248	144	55
			248	165	95

			226	5	49
			172	44	69
			150	2	31
			238	53	89
			238	91	120

			*/

			var chartData = {};
			var countries = ['Hungary', 'Slovakia', 'Slovenia', 'Romania', 'Croatia', 
				'Italy', 'Austria', 'France', 'Spain', 'Germany', 'US'];

			var colors = ['rgba(226,5,49,.8)', 'rgba(74,186,191,.8)', 'rgba(72,210,5,.8)', 'rgba(4,140,147,.8)', 'rgba(243,115,6,.8)', 'rgba(172,44,69,.8)'];
			var tcolors = ['rgba(226,5,49,.1)', 'rgba(74,186,191,.1)', 'rgba(72,210,5,.1)', 'rgba(4,140,147,.1)', 'rgba(243,115,6,.1)', 'rgba(172,44,69,.1)'];

			var tabBar, contentEls;
			var chartData;

			$(document ).ready(function() {
				//mdc.topAppBar.MDCTopAppBar.attachTo(document.querySelector('.mdc-top-app-bar'));
				
				tabBar = new mdc.tabBar.MDCTabBar(document.querySelector('.mdc-tab-bar'));
				contentEls = document.querySelectorAll('.tabcontent');

				tabBar.listen('MDCTabBar:activated', function(event) {
					// Hide currently-active content
					document.querySelector('.tabcontent--active').classList.remove('tabcontent--active');
					// Show content for newly-activated tab
					contentEls[event.detail.index].classList.add('tabcontent--active');
				});

				loadData();
			});

			function loadData() {
				var eastCountries = ['Slovakia', 'Romania', 'Croatia', 'Hungary', 'Slovenia'];
				var westCountries = ['US', 'United Kingdom', 'Germany', 'Austria', 'Italy', 'Spain'];
				fetch('/data?'+Math.random())
					.then(response => response.json())
					.then((data) => {
						chartData = data;
						makeChart(chartData.cases, eastCountries, 'chart');
						makeChart(chartData.cases, westCountries, 'chartw');
						makeChart(chartData.newCases, eastCountries, 'chartn');
						makeChart(chartData.newCases, westCountries, 'chartnw');
						makeChart(chartData.deathRates, eastCountries, 'chartd', { 
							yaxis: { labels: { formatter: (value) => (value*100).toFixed(1) +'%'} },
						});
						makeChart(chartData.deathRates, westCountries, 'chartdw', { 
							yaxis: { labels: { formatter: (value) => (value*100).toFixed(1) +'%'} },
						});
					});
			}

			function makeChart(data, countries, elem, optionMixins = {}) {
				var options = {
					chart: {
						type: 'line',
						background: 'rgba(4, 140, 147, 0)',
						toolbar: {show: false},
						width: '100%',
						height: '52%'
					},
					series: [
					],
					xaxis: {
						categories: chartData.labels,
						labels: { show: false }
					},
					grid: {
						borderColor: 'rgba(255,255,255, 0.1)'	
					},
					yaxis: {
					
					},
					theme: { mode: 'dark'},
					
				};
				countries.forEach((val) => {
					options.series.push({name: val, data: data[val]});
				});
				for (s in optionMixins) options[s] = optionMixins[s]

				var chart = new ApexCharts(document.querySelector("#"+elem), options);

				chart.render();
			}

			
		</script>
	</body>
</html>